import request from 'supertest';import {app} from '../../src';import {HTTP_STATUSES} from "../../src/constants/http-statuses";import {ISamurai} from "../../src/types";describe('/samurai', () => {    let createdSamurai: ISamurai | null = null;    let secondCreatedSamurai: ISamurai | null = null;    beforeAll(async () => {        await request(app)            .delete('/__test__/data');    });    it(`Should return code ${HTTP_STATUSES.OK} and an empty array`, async () => {        await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK, []);    });    it(`Should return ${HTTP_STATUSES.NOT_FOUND} code for non-existent samurai`, async () => {        await request(app)            .get('/samurai/1')            .expect(HTTP_STATUSES.NOT_FOUND);    });    it(`Should return code ${HTTP_STATUSES.BAD_REQUEST} and not create a samurai without age`, async () => {        await request(app)            .post('/samurai')            .send({ name: 'Dju-won' })            .expect(HTTP_STATUSES.BAD_REQUEST)    });    it(`Should return code ${HTTP_STATUSES.OK} and an empty array`, async () => {        await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK, []);    });    it(`Should return code ${HTTP_STATUSES.NOT_FOUND} and not create a samurai with empty values`, async () => {        await request(app)            .post('/samurai')            .send({ name: '', age: '' })            .expect(HTTP_STATUSES.BAD_REQUEST)    });    it(`Should return code ${HTTP_STATUSES.OK} and empty array`, async () => {        await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK, []);    });    it(`Should create a samurai with valid data, return code ${HTTP_STATUSES.CREATED} with created samurai`, async () => {        const createResponse = await request(app)            .post('/samurai')            .send({ name: 'Test-name', age: 99 })            .expect(HTTP_STATUSES.CREATED);        createdSamurai = createResponse.body;        expect(createdSamurai).toEqual({            id: expect.any(Number),            name: 'Test-name',            age: 99,        });        await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK, [createdSamurai]);    });    it(`Should update a samurai with valid data, return code ${HTTP_STATUSES.OK} with updated samurai`, async () => {        if (!createdSamurai) {            expect(true).toBe(false);        }        const createResponse = await request(app)            .put(`/samurai/${createdSamurai!.id}`)            .send({ name: 'Good name', age: 11 })            .expect(HTTP_STATUSES.OK);        const updatedSamurai = createResponse.body;        expect(updatedSamurai).toEqual({            id: createdSamurai!.id,            name: 'Good name',            age: 11,        });        await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK, [updatedSamurai]);    });    it(`Should return code ${HTTP_STATUSES.BAD_REQUEST} with empty data`, async () => {        if (!createdSamurai) {            expect(true).toBe(false);        }        await request(app)            .put(`/samurai/${createdSamurai!.id}`)            .send({ name: '', age: 0 })            .expect(HTTP_STATUSES.BAD_REQUEST);    });    it(`Should return code ${HTTP_STATUSES.BAD_REQUEST} without name`, async () => {        if (!createdSamurai) {            expect(true).toBe(false);        }        await request(app)            .put(`/samurai/${createdSamurai!.id}`)            .send({ age: 44 })            .expect(HTTP_STATUSES.BAD_REQUEST);    });    it(`Should return code ${HTTP_STATUSES.BAD_REQUEST} without age`, async () => {        if (!createdSamurai) {            expect(true).toBe(false);        }        await request(app)            .put(`/samurai/${createdSamurai!.id}`)            .send({ name: 'Test-name' })            .expect(HTTP_STATUSES.BAD_REQUEST);    });    it(`Should return code ${HTTP_STATUSES.OK} and array with updated samurai`, async () => {        const createResponse = await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK);        const currentSamurai = createResponse.body;        expect(currentSamurai).toEqual([{            id: createdSamurai!.id,            name: 'Good name',            age: 11,        }]);    });    it(`Should create a second samurai, return code ${HTTP_STATUSES.CREATED} with created samurai`, async () => {        if (!createdSamurai) {            expect(true).toBe(false);        }        const createResponse = await request(app)            .post('/samurai')            .send({ name: 'Second samurai', age: 22 })            .expect(HTTP_STATUSES.CREATED);        secondCreatedSamurai = createResponse.body;        expect(secondCreatedSamurai).toEqual({            id: expect.any(Number),            name: 'Second samurai',            age: 22,        });        await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK, [                {                    id: createdSamurai!.id,                    name: 'Good name',                    age: 11,                },                secondCreatedSamurai,            ]);    });    it('Should successfully remove samurai by sent id', async () => {        if (!createdSamurai) {            expect(true).toBe(false);        }        await request(app)            .delete(`/samurai/${createdSamurai!.id}`)            .expect(`"Samurai ${createdSamurai!.id} successfully removed"`);        const createResponse = await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK);        const currentSamurai = createResponse.body;        expect(currentSamurai).toEqual([secondCreatedSamurai]);    });    it(`Should return code ${HTTP_STATUSES.NOT_FOUND} and not remove samurai by sent id`, async () => {        await request(app)            .delete(`/samurai/-100`)            .expect(HTTP_STATUSES.NOT_FOUND, `"Samurai -100 does not exist"`);        const createResponse = await request(app)            .get('/samurai')            .expect(HTTP_STATUSES.OK);        const currentSamurai = createResponse.body;        expect(currentSamurai).toEqual([secondCreatedSamurai]);    });});